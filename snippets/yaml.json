{
	"Subset Destination Rule": {
		"scope": "yml, yaml",
		"prefix": "subset-destinatin-rule",
		"description": "Destination rule with two subsets",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: DestinationRule",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  host: $1",
			"  subsets:",
			"  - labels:",
			"      ${3:version}: $4",
			"    name: ${3:version}-$4",
			"  - labels:",
			"      ${3:version}: $5",
			"    name: ${3:version}-$5"
		]
	},
	"Canary Release Virtual Service": {
		"scope": "yml, yaml",
		"prefix": "canary",
		"description": "Canary release between two versions",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: VirtualService",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  hosts:",
			"  - $1",
			"  http:",
			"  - route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${3:version}-$4",
			"      weight: ${5:90}",
			"    - destination:",
			"        host: $1",
			"        subset: ${3:version}-$6",
			"      weight: ${7:10}"
		]
	},
	"Mirroring Traffic Virtual Service": {
		"scope": "yml, yaml",
		"prefix": "mirror",
		"description": "Shadow traffic between two versions",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: VirtualService",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  hosts:",
			"  - $1",
			"  http:",
			"  - route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${3:version}-$4",
			"    mirror:",
			"      host: $1",
			"      subset: ${3:version}-$5"
		]
	},
	"Route by Header Virtual Service": {
		"scope": "yml, yaml",
		"prefix": "route-by-header",
		"description": "Route to a specific version depending on header value",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: VirtualService",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  hosts:",
			"  - $1",
			"  http:",
			"  - match:",
			"    - headers:",
			"        $3:",
			"          ${4:exact|prefix|regex}: $5",
			"    route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${6:version}-$7",
			"  - route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${6:version}-$8"
		]
	},
	"Route by caller Labels Virtual Service": {
		"scope": "yml, yaml",
		"prefix": "route-by-caller-labels",
		"description": "Route to a specific version depending on caller labels",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: VirtualService",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  hosts:",
			"  - $1",
			"  http:",
			"  - match:",
			"    - sourceLabels:",
			"        ${3:app}: $4",
			"        ${5:version}: $6",
			"    route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${7:version}-$8",
			"  - route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${7:version}-$9"
		]
	},
	"Route by Cookie Virtual Service": {
		"scope": "yml, yaml",
		"prefix": "route-by-cookie",
		"description": "Route to a specific version depending on cookie value",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: VirtualService",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  hosts:",
			"    - $1",
			"  http:",
			"  - match:",
			"    - headers:",
			"        cookie:",
			"          ${3:exact|prefix|regex}: $4",
			"    route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${5:version}-$6",
			"  - route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${5:version}-$7"
		]
	},
	"Route by URI Virtual Service": {
		"scope": "yml, yaml",
		"prefix": "route-by-uri",
		"description": "Route to a specific version depending on uri",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: VirtualService",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  hosts:",
			"  - $1",
			"  http:",
			"  - match:",
			"    - uri:",
			"        ${3:exact|prefix|regex}: $4",
			"    route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${5:version}-$6",
			"  - route:",
			"    - destination:",
			"        host: $1",
			"        subset: ${5:version}-$7"
		]
	},
	"Egress Service Entry": {
		"scope": "yml, yaml",
		"prefix": "egress",
		"description": "Egress to external site",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: ServiceEntry",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  hosts:",
			"  - $3",
			"  ports:",
			"  - name: $4-${5:80}",
			"    number: $5",
			"    protocol: ${6:http}"
		]
	},
	"Whitelist between Services": {
		"scope": "yml, yaml",
		"prefix": "whitelist",
		"description": "Whitelist between two services",
		"body": [
			"apiVersion: config.istio.io/v1alpha2",
			"kind: listchecker",
			"metadata:",
			"  name: $1whitelist",
			"  namespace: $2",
			"spec:",
			"  overrides: [$3]",
			"  blacklist: false",
			"---",
			"apiVersion: config.istio.io/v1alpha2",
			"kind: listentry",
			"metadata:",
			"  name: $1source",
			"  namespace: $2",
			"spec:",
			"  value: source.labels[${4:\"app\"}]",
			"---",
			"apiVersion: config.istio.io/v1alpha2",
			"kind: rule",
			"metadata:",
			"  name: checkfrom$3",
			"  namespace: $2",
			"spec:",
			"  match: destination.labels[${4:\"app\"}] == \"$1\"",
			"  actions:",
			"  - handler: $1whitelist.listchecker",
			"    instances:",
			"    - $1source.listentry"
		]
	},
	"Retry Host Virtual Service": {
		"scope": "yml, yaml",
		"prefix": "retry-host",
		"description": "Retry to Host",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: VirtualService",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  hosts:",
			"  - $1",
			"  http:",
			"  - retries:",
			"      attempts: ${3:3}",
			"      perTryTimeout: ${4:4.000s}",
			"    route:",
			"    - destination:",
			"        host: $1"
		]
	},
	"Connection Pool and Circuit Breaker Destination Rule": {
		"scope": "yml, yaml",
		"prefix": "circuit-breaker",
		"description": "Connection Pool + Circuit Breaker",
		"body": [
			"apiVersion: networking.istio.io/v1alpha3",
			"kind: DestinationRule",
			"metadata:",
			"  name: $1",
			"  namespace: $2",
			"spec:",
			"  host: $1",
			"  trafficPolicy:",
			"    connectionPool:",
			"      http:",
			"        http1MaxPendingRequests: ${3:1}",
			"        maxRequestsPerConnection: ${3:1}",
			"      tcp:",
			"        maxConnections: ${3:1}",
			"    outlierDetection:",
			"      http:",
			"        baseEjectionTime: ${4:120.000s}",
			"        consecutiveErrors: ${5:1}",
			"        interval: ${6:1.000s}",
			"        maxEjectionPercent: ${7:100}"
		]
	}
}